/*
 * Copyright (c) 2024 Nordic Semiconductor
 * SPDX-License-Identifier: LicenseRef-Nordic-5-Clause
 */

#include "kestrel_nrf9151_common-pinctrl.dtsi"
#include "kestrel_common.dtsi"

&spi3 {
	compatible = "nordic,nrf-spim";
	status = "disabled";

	pinctrl-0 = <&spi3_default>;
	pinctrl-1 = <&spi3_sleep>;
	pinctrl-names = "default", "sleep";


	// flash_ext: s25fl256s@0 {
	// 	compatible = "jedec,spi-nor";
	// 	status = "disabled";
	// 	reg = <0>;
	// 	spi-max-frequency = <8000000>;
	// 	size = <268435456>;
	// 	jedec-id = [01 02 19];
	// 	use-4b-addr-opcodes;
	// };
	
	// flash_ext: GD25LE255E@0 {
	// 	compatible = "jedec,spi-nor";
	// 	status = "disabled";
	// 	reg = <0>;
	// 	spi-max-frequency = <8000000>;
	// 	size = <268435456>;
	// 	has-dpd;
	// 	t-enter-dpd = <3000>;
	// 	t-exit-dpd = <20000>;
	// 	sfdp-bfp = [e5 20 f3 ff  ff ff ff 0f  44 eb 08 6b  08 3b 42 bb
	// 		    fe ff ff ff  ff ff 00 ff  ff ff 42 eb  0c 20 0f 52
	// 		    10 d8 00 ff  d4 31 a5 fe  84 df 14 4f  ec 62 16 33
	// 		    7a 75 7a 75  04 b3 d5 5c  19 06 14 00  08 50 00 01];
	// 	jedec-id = [c8 60 19];
	// };

	flash_ext: gd25wb256e3ir@0 {
		compatible = "jedec,spi-nor";
		status = "disabled";
		reg = <0>;
		spi-max-frequency = <8000000>;
		size = <268435456>;
		has-dpd;
		t-enter-dpd = <3000>;
		t-exit-dpd = <40000>;
		sfdp-bfp = [
			e5 20 f3 ff  ff ff ff 0f  44 eb 08 6b  08 3b 42 bb
			ee ff ff ff  ff ff 00 ff  ff ff 00 ff  0c 20 0f 52
			10 d8 00 ff  44 7a c9 fe  83 67 26 62  ec 82 18 44
			7a 75 7a 75  04 c4 d5 5c  00 06 74 00  08 50 00 01
			];
		jedec-id = [c8 65 19];
	};

	
	imu: icm42688@2 {
        compatible = "invensense,icm42688";
        reg = <2>;                       
        spi-max-frequency = <8000000>;
        status = "disabled";
        int-gpios = <&gpio0 26 GPIO_ACTIVE_HIGH>;
		vin-supply = <&ldsw_sensors>;

		accel-pwr-mode = <ICM42688_DT_ACCEL_LN>;
		accel-fs = <ICM42688_DT_ACCEL_FS_16>;
		accel-odr = <ICM42688_DT_ACCEL_ODR_2000>;
		gyro-pwr-mode= <ICM42688_DT_GYRO_LN>;
		gyro-fs = <ICM42688_DT_GYRO_FS_2000>;
		gyro-odr = <ICM42688_DT_GYRO_ODR_2000>;
    };

};
/ {
	model = "Kalscott Kestrel nRF9151";
	compatible = "Kalscott,kestrel-nrf9151";

	//  i2c_bb0: i2c {
    //     compatible = "gpio-i2c";
    //     status = "okay";
    //     scl-gpios = <&gpio0 9 (GPIO_OPEN_DRAIN | GPIO_PULL_UP)>;
    //     sda-gpios = <&gpio0 8 (GPIO_OPEN_DRAIN | GPIO_PULL_UP)>;
    //     clock-frequency = <I2C_BITRATE_STANDARD>;
    //     label = "I2C_BB0";

    //     #address-cells = <1>;
    //     #size-cells = <0>;
    // };

	chosen {
		zephyr,console = &uart0;
		zephyr,shell-uart = &uart0;
		zephyr,uart-mcumgr = &uart1;
		nordic,pm-ext-flash = &flash_ext;
	};

	buttons {
		compatible = "gpio-keys";
		ipc1: button_0 {
			gpios = <&gpio0 16 (GPIO_ACTIVE_HIGH)>;
		};
	};

	aliases {
		sw0 = &ipc1;                
		mcuboot-button0 = &ipc1;     
		spi-flash0 = &flash_ext;
	};
};

&adc {
	status = "okay";
};

&gpiote {
	status = "okay";
};



&gpio0 {
	status = "okay";
	/* Use PORT event rather than GPIOTE IN event, to save power */
	sense-edge-mask = <0xffffffff>;
	/* Load switch controlling 3.3V supply and I/O voltage for external boards */
	/* Disabled for standalone nRF9151 - re-enable if you have expansion connectors that need power switching
	exp_board_enable: exp_board_enable {
		gpio-hog;
		output-low;
		gpios = <3 GPIO_ACTIVE_HIGH>;
	};
	*/
};

/* PWM0 disabled - RGB LEDs not present on standalone design */
&pwm0 {
	status = "disabled";
};

&pmic_main {
	
};


&flash_ext {
	status = "okay";
};


&i2c2 {
	status = "okay";
	
};
&spi3 {
	status = "okay";
	cs-gpios = 
		<&gpio0 0 GPIO_ACTIVE_LOW>, 
		<&gpio0 27 GPIO_ACTIVE_LOW>,  
		<&gpio0 15 GPIO_ACTIVE_LOW>;

	//old
	// cs-gpios = 
	// 	<&gpio0 10 GPIO_ACTIVE_LOW>, 
	// 	<&gpio0 14 GPIO_ACTIVE_LOW>,  
	// 	<&gpio0 7 GPIO_ACTIVE_LOW>;
};

&pmic_main {
	status = "okay";
	
	npm1300_gpios {
		status = "okay";
	};
	regulators {
		status = "okay";
	};
	charger {
		status = "okay";
	};
};

&timer0 {
	status = "okay";
};

&timer1 {
	status = "okay";
};

&timer2 {
	status = "okay";
};

&uart1 {
	compatible = "nordic,nrf-uarte";
	current-speed = <115200>;
	status = "okay";
	pinctrl-0 = <&uart1_default>;
	pinctrl-1 = <&uart1_sleep>;
	pinctrl-names = "default", "sleep";
};

&uart0 {
	compatible = "nordic,nrf-uarte";
	current-speed = <115200>;
	status = "okay";
	pinctrl-0 = <&uart0_default>;
	pinctrl-1 = <&uart0_sleep>;
	pinctrl-names = "default", "sleep";
};



#include <common/nordic/nrf91xx_partition.dtsi>